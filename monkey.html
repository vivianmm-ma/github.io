import React, { useState, useEffect, useRef, useCallback } from 'react';
import { initializeApp } from 'firebase/app';
import { getAuth, signInAnonymously } from 'firebase/auth';
import { getFirestore, doc, setDoc, onSnapshot } from 'firebase/firestore';

// Global variables provided by the Canvas environment
const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

// Initialize Firebase (only once)
let app;
let db;
let auth;

try {
  app = initializeApp(firebaseConfig);
  db = getFirestore(app);
  auth = getAuth(app);
} catch (error) {
  console.error("Firebase initialization error:", error);
  // Handle error gracefully in UI if needed
}

// Main App Component
const App = () => {
    // State for daily quests (pre-defined)
    const [dailyQuests, setDailyQuests] = useState({
        feedDogDaily: false, letDogOutDaily: false, closeWindowsAC: false,
        upstairsAC: false, kitchenMorning: false, clearFloorsMorning: false,
        sweepMorning: false, coffeePrepCheck: false, dogDinner: false,
        sayHello: false, aloneTime: false, dogBed: false,
        monkeyAloneTimeTasks: false, bonoboAloneTimeTasks: false, checkChoresLate: false,
        bedtimeRoutine: false
    });

    // State for custom quests (user-added)
    const [customQuests, setCustomQuests] = useState([]);
    const [newCustomTaskInput, setNewCustomTaskInput] = useState('');

    // State for tally boards
    const [kindnessTally, setKindnessTally] = useState({
        kindnessLevel: 0, kindToSelfBonobo: 0, kindToSelfMonkey: 0,
        kindToMonkey: 0, kindToBonobo: 0
    });
    const [questionsAsked, setQuestionsAsked] = useState(0);

    // Stopwatch state
    const [stopwatchTime, setStopwatchTime] = useState({ hours: 0, minutes: 0, seconds: 0 });
    const [isRunning, setIsRunning] = useState(false);
    const timerRef = useRef(null); // Ref to hold the setInterval ID

    // Firestore document reference
    const docRef = useRef(null);

    // Authenticate and set up Firestore listener
    useEffect(() => {
        const setupFirebase = async () => {
            if (!db || !auth) {
                console.error("Firebase is not initialized.");
                return;
            }

            try {
                if (initialAuthToken) {
                    await signInAnonymously(auth); // Using anonymous sign-in for simplicity
                } else {
                    await signInAnonymously(auth);
                }
                console.log("Firebase authenticated anonymously.");

                // Use a fixed document ID for shared data within the public collection
                // This means anyone with access to this app ID can see/edit this document.
                docRef.current = doc(db, `artifacts/${appId}/public/data/shared-quest-log`);

                // Set up real-time listener for the document
                const unsubscribe = onSnapshot(docRef.current, (docSnap) => {
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        console.log("Firestore data received:", data);
                        // Update states based on Firestore data
                        if (data.dailyQuests) setDailyQuests(data.dailyQuests);
                        if (data.customQuests) setCustomQuests(data.customQuests);
                        if (data.kindnessTally) setKindnessTally(data.kindnessTally);
                        if (data.questionsAsked !== undefined) setQuestionsAsked(data.questionsAsked);
                    } else {
                        console.log("No such document! Initializing with default data.");
                        // If document doesn't exist, create it with default states
                        saveAllStates();
                    }
                }, (error) => {
                    console.error("Error listening to Firestore document:", error);
                });

                return () => unsubscribe(); // Cleanup listener on unmount

            } catch (error) {
                console.error("Firebase auth or listener setup failed:", error);
            }
        };

        setupFirebase();
    }, []); // Run once on component mount

    // Function to save all states to Firestore
    const saveAllStates = useCallback(async () => {
        if (!docRef.current) {
            console.warn("Document reference not yet available. Cannot save states.");
            return;
        }
        try {
            await setDoc(docRef.current, {
                dailyQuests,
                customQuests,
                kindnessTally,
                questionsAsked
            }, { merge: true }); // Use merge to avoid overwriting other fields
            console.log("States saved to Firestore.");
        } catch (error) {
            console.error("Error saving states to Firestore:", error);
        }
    }, [dailyQuests, customQuests, kindnessTally, questionsAsked]);

    // Save states whenever they change (debounced for performance if needed, but simple for now)
    useEffect(() => {
        saveAllStates();
    }, [dailyQuests, customQuests, kindnessTally, questionsAsked, saveAllStates]);

    // === Stopwatch Logic ===
    useEffect(() => {
        if (isRunning) {
            timerRef.current = setInterval(() => {
                setStopwatchTime(prevTime => {
                    let { hours, minutes, seconds } = prevTime;
                    seconds++;
                    if (seconds === 60) {
                        seconds = 0;
                        minutes++;
                        if (minutes === 60) {
                            minutes = 0;
                            hours++;
                        }
                    }
                    return { hours, minutes, seconds };
                });
            }, 1000);
        } else {
            clearInterval(timerRef.current);
        }
        return () => clearInterval(timerRef.current); // Cleanup on unmount
    }, [isRunning]);

    const formatTime = (h, m, s) => {
        const pad = (num) => String(num).padStart(2, '0');
        return `Stopwatch: ${pad(h)}:${pad(m)}:${pad(s)}`;
    };

    const handleStartStopwatch = () => {
        setIsRunning(prev => !prev);
    };

    const handleResetStopwatch = () => {
        setIsRunning(false);
        setStopwatchTime({ hours: 0, minutes: 0, seconds: 0 });
    };

    // === Progress Bar Logic ===
    const updateProgressBar = useCallback(() => {
        const allCheckboxes = document.querySelectorAll('.game-panel input[type="checkbox"]');
        let checkedCount = 0;
        allCheckboxes.forEach(checkbox => {
            if (checkbox.checked) {
                checkedCount++;
            }
        });
        const totalTasks = allCheckboxes.length;
        const percentage = totalTasks > 0 ? (checkedCount / totalTasks) * 100 : 0;
        return `${Math.round(percentage)}%`;
    }, []);

    // Re-calculate progress bar percentage whenever relevant states change
    const progressBarPercentage = updateProgressBar();

    // === Daily Quests Logic ===
    const handleDailyQuestChange = (id) => {
        setDailyQuests(prev => ({
            ...prev,
            [id]: !prev[id]
        }));
    };

    const handleResetDailyQuests = () => {
        const resetState = Object.fromEntries(
            Object.keys(dailyQuests).map(key => [key, false])
        );
        setDailyQuests(resetState);
    };

    // === Custom Quests Logic ===
    const handleAddCustomTask = () => {
        if (newCustomTaskInput.trim()) {
            setCustomQuests(prev => [
                ...prev,
                { id: Date.now().toString(), text: newCustomTaskInput.trim(), checked: false, timeNote: '' }
            ]);
            setNewCustomTaskInput('');
        }
    };

    const handleCustomTaskChange = (id) => {
        setCustomQuests(prev =>
            prev.map(task =>
                task.id === id ? { ...task, checked: !task.checked } : task
            )
        );
    };

    const handleCustomTimeNoteChange = (id, value) => {
        setCustomQuests(prev =>
            prev.map(task =>
                task.id === id ? { ...task, timeNote: value } : task
            )
        );
    };

    const handleDeleteCustomTask = (id) => {
        setCustomQuests(prev => prev.filter(task => task.id !== id));
    };

    // === Tally Board Logic ===
    const handleTallyIncrement = (tallyKey) => {
        setKindnessTally(prev => ({
            ...prev,
            [tallyKey]: prev[tallyKey] + 1
        }));
    };

    const handleResetKindnessTally = () => {
        setKindnessTally({
            kindnessLevel: 0, kindToSelfBonobo: 0, kindToSelfMonkey: 0,
            kindToMonkey: 0, kindToBonobo: 0
        });
    };

    const handleQuestionsAskedIncrement = () => {
        setQuestionsAsked(prev => prev + 1);
    };

    const handleResetQuestionsTally = () => {
        setQuestionsAsked(0);
    };

    return (
        <div className="main-container">
            {/* Reusable Header Code */}
            <a href="https://www.cindnesskult.com" className="sticker-link">
                <div className="sticker-container">
                    {/* JS will populate this (if any, not included in React version directly) */}
                    <div className="yin-yang"></div>
                    <p className="bottom-text">not just right</p>
                </div>
            </a>
            
            <header className="site-header">
                <h1>Cindness KULT</h1>
                <p>* ✧ The answer is always kindness. (not a cult btw) ✧ *</p>
            </header>
            {/* End of Reusable Header Code */}

            <div className="game-container">
                <h1 className="game-title">QUEST LOG</h1>
                <p className="game-subtitle">Track your progress, brave adventurers!</p>

                {/* Progress Bar */}
                <div className="progress-bar-area">
                    <div className="progress-bar-label">Overall Progress</div>
                    <div className="progress-bar-container">
                        <div className="progress-bar-fill" style={{ width: progressBarPercentage }}>
                            <span className="progress-bar-percentage">{progressBarPercentage} Complete</span>
                        </div>
                    </div>
                    <p className="note-text">Check off tasks to see your progress update!</p>
                </div>

                {/* Daily Chore Checklist */}
                <div className="game-panel">
                    <h2 className="panel-title">Daily Quests <span className="text-xs text-gray-400 block mt-1">(Split tasks based on days off)</span></h2>
                    <p className="text-sm text-gray-300 mb-4">
                        **Monkey's Days Off:** Monday, Tuesday, Wednesday<br/>
                        **Bonobo's Days Off:** Saturday, Sunday<br/>
                        **Friday:** Bonobo usually takes lead on evening tasks.
                    </p>
                    <ul>
                        {Object.entries(dailyQuests).map(([id, checked]) => (
                            <li className="checkbox-item" key={id}>
                                <input
                                    type="checkbox"
                                    id={id}
                                    checked={checked}
                                    onChange={() => handleDailyQuestChange(id)}
                                />
                                <label htmlFor={id}>
                                    {id === 'feedDogDaily' && 'Feed the dog breakfast'}
                                    {id === 'letDogOutDaily' && 'Get the dog up and let him out'}
                                    {id === 'closeWindowsAC' && 'Close all windows if hot & turn on fan/AC'}
                                    {id === 'upstairsAC' && 'Ensure upstairs AC is on & windows by AC are shut (daytime)'}
                                    {id === 'kitchenMorning' && '**Kitchen Cleanup (By Morning):** Dishes done/put away, counters & stove wiped'}
                                    {id === 'clearFloorsMorning' && '**Clear Surfaces (By Morning):** Pick clothes off floor, clear counters, wipe counters, ensure no clothes on chairs/bed/couch'}
                                    {id === 'sweepMorning' && '**Sweep (By Morning):** Main living area floor swept'}
                                    {id === 'coffeePrepCheck' && 'Coffee prepared the night before'}
                                    {id === 'dogDinner' && 'Feed the dog dinner around 6-7pm'}
                                    {id === 'sayHello' && '**Evening Connection:** Say hello & hang out (10-11 PM for Bonobo)'}
                                    {id === 'aloneTime' && '**Alone Time:** Bonobo gets 1-2 hours for tasks/decompression (11 PM - 12/1 AM)'}
                                    {id === 'dogBed' && 'Dog goes to sleep'}
                                    {id === 'monkeyAloneTimeTasks' && '**During Bonobo\'s Alone Time:** Monkey works on his own stuff (e.g., planters, school stuff)'}
                                    {id === 'bonoboAloneTimeTasks' && '**During Bonobo\'s Alone Time:** Bonobo works on work/school or exercises (bike) (Monkey generally should not talk during this)'}
                                    {id === 'checkChoresLate' && '**Late Night Check (1 AM):** Confirm daily chores (dishes, etc.) are done'}
                                    {id === 'bedtimeRoutine' && '**Bedtime Routine (By 2:30 AM):** Prepare outfits for next day, brush teeth, meds/water by bed, aim to be *in bed* by 3 AM'}
                                </label>
                                <span className="time-estimate">
                                    {id === 'feedDogDaily' && '~3 min'}
                                    {id === 'letDogOutDaily' && '~5 min'}
                                    {id === 'closeWindowsAC' && '~3 min'}
                                    {id === 'upstairsAC' && '~5 min'}
                                    {id === 'kitchenMorning' && '~10 min'}
                                    {id === 'clearFloorsMorning' && '~10 min'}
                                    {id === 'sweepMorning' && '~5 min'}
                                    {id === 'coffeePrepCheck' && '~5 min'}
                                    {id === 'dogDinner' && '~3 min'}
                                    {id === 'sayHello' && '30-60 min'}
                                    {id === 'aloneTime' && '60-120 min'}
                                    {id === 'dogBed' && '5 min'}
                                    {id === 'monkeyAloneTimeTasks' && '~30 min'}
                                    {id === 'bonoboAloneTimeTasks' && '~30 min'}
                                    {id === 'checkChoresLate' && '~5 min'}
                                    {id === 'bedtimeRoutine' && '~30 min'}
                                </span>
                            </li>
                        ))}
                    </ul>
                    <div className="mt-6 text-center">
                        <button id="resetDailyQuestsButton" className="add-button" onClick={handleResetDailyQuests}>RESET DAILY QUESTS</button>
                        <p className="note-text mt-2">Click to uncheck all quests in this section.</p>
                    </div>
                </div>

                {/* Personal Daily Quests */}
                <div className="game-panel">
                    <h2 className="panel-title">Personal Daily Quests <span className="text-xs text-gray-400 block mt-1">(Add your custom tasks!)</span></h2>
                    <div className="custom-task-input-group">
                        <input
                            type="text"
                            id="newCustomTaskInput"
                            className="custom-task-input"
                            placeholder="Enter new custom quest..."
                            value={newCustomTaskInput}
                            onChange={(e) => setNewCustomTaskInput(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && handleAddCustomTask()}
                        />
                        <button id="addCustomTaskButton" className="add-button" onClick={handleAddCustomTask}>ADD QUEST</button>
                    </div>
                    <ul id="customTaskList">
                        {customQuests.map(task => (
                            <li className="checkbox-item" key={task.id}>
                                <input
                                    type="checkbox"
                                    id={`custom-${task.id}`}
                                    checked={task.checked}
                                    onChange={() => handleCustomTaskChange(task.id)}
                                />
                                <label htmlFor={`custom-${task.id}`}>{task.text}</label>
                                <input
                                    type="text"
                                    className="custom-time-input"
                                    placeholder="e.g., 15min"
                                    value={task.timeNote}
                                    onChange={(e) => handleCustomTimeNoteChange(task.id, e.target.value)}
                                />
                                <button className="delete-button" onClick={() => handleDeleteCustomTask(task.id)}>DELETE</button>
                            </li>
                        ))}
                    </ul>
                    <p className="note-text mt-4">Your custom quests will save automatically!</p>
                </div>

                {/* Mission Control Panel (Timer, Next Step) */}
                <div className="mission-control-panel">
                    <h2 className="panel-title">Mission Control</h2>
                    <div className="timer-display" id="stopwatchDisplay">
                        {formatTime(stopwatchTime.hours, stopwatchTime.minutes, stopwatchTime.seconds)}
                    </div>
                    <p className="text-sm text-gray-300" id="currentTaskDisplay">Current Task: {isRunning ? 'In Progress...' : 'Ready to Start'}</p>
                    <div className="mt-4">
                        <button className="action-button" onClick={handleStartStopwatch}>
                            {isRunning ? '⏸️ PAUSE TIMER' : '▶️ START TIMER'}
                        </button>
                        <button className="action-button" onClick={handleResetStopwatch}>⏭️ RESET TIMER</button>
                    </div>
                    <p className="note-text" id="timerNote">{isRunning ? 'Timer is running!' : 'Click START TIMER to begin your session.'}</p>
                </div>

                {/* Kindness Tally Board */}
                <div className="game-panel">
                    <h2 className="panel-title">Kindness Tally Board</h2>
                    <p className="note-text mb-4">Track your kindness stats! (Manual tally)</p>
                    <div className="tally-board">
                        <div className="tally-item">
                            <span>Kind to Monkey:</span>
                            <span className="tally-count">{kindnessTally.kindToMonkey}</span>
                            <button className="tally-button" onClick={() => handleTallyIncrement('kindToMonkey')}>+</button>
                        </div>
                        <div className="tally-item">
                            <span>Kind to Bonobo:</span>
                            <span className="tally-count">{kindnessTally.kindToBonobo}</span>
                            <button className="tally-button" onClick={() => handleTallyIncrement('kindToBonobo')}>+</button>
                        </div>
                        <div className="tally-item">
                            <span>Kind to Self (Bonobo):</span>
                            <span className="tally-count">{kindnessTally.kindToSelfBonobo}</span>
                            <button className="tally-button" onClick={() => handleTallyIncrement('kindToSelfBonobo')}>+</button>
                        </div>
                        <div className="tally-item">
                            <span>Kind to Self (Monkey):</span>
                            <span className="tally-count">{kindnessTally.kindToSelfMonkey}</span>
                            <button className="tally-button" onClick={() => handleTallyIncrement('kindToSelfMonkey')}>+</button>
                        </div>
                        <div className="tally-item">
                            <span>Kindness Level:</span>
                            <span className="tally-count">{kindnessTally.kindnessLevel}</span>
                            <button className="tally-button" onClick={() => handleTallyIncrement('kindnessLevel')}>+</button>
                        </div>
                        <p className="tally-explanation mt-4">Increase your kindness level by being intentional and thoughtful in your actions towards yourself and each other. Remember, the answer is always kindness! ✨</p>
                        <div className="mt-4 text-center">
                            <button className="tally-reset-button" onClick={handleResetKindnessTally}>RESET KINDNESS TALLY</button>
                        </div>
                    </div>
                </div>

                {/* Question Tally Board */}
                <div className="game-panel">
                    <h2 className="panel-title">Monkey's Question Tally</h2>
                    <p className="note-text mb-4">Tracks Monkey's question limit. (Manual tally)</p>
                    <div className="tally-board">
                        <div className="tally-item">
                            <span>Questions Asked Today:</span>
                            <span className="tally-count">{questionsAsked}</span>
                            <button className="tally-button" onClick={handleQuestionsAskedIncrement}>+</button>
                        </div>
                        <p className="tally-explanation mt-4">Monkey has a maximum of **10 minutes** or **two separate instances** per day for repetitive/reassurance-seeking questions. Use the stopwatch above to help track time if needed.</p>
                        <div className="mt-4 text-center">
                            <button className="tally-reset-button" onClick={handleResetQuestionsTally}>RESET QUESTIONS TALLY</button>
                        </div>
                    </div>
                </div>

                {/* Recurring Chore Checklist */}
                <div className="game-panel">
                    <h2 className="panel-title">Weekly & Bi-Weekly Quests</h2>
                    <ul>
                        <li className="checkbox-item">
                            <input type="checkbox" id="dogPoop" checked={dailyQuests.dogPoop} onChange={() => handleDailyQuestChange('dogPoop')} />
                            <label htmlFor="dogPoop">Pick up dog poop (daily/as needed)</label>
                        </li>
                        <li className="checkbox-item">
                            <input type="checkbox" id="cleanBathroom" checked={dailyQuests.cleanBathroom} onChange={() => handleDailyQuestChange('cleanBathroom')} />
                            <label htmlFor="cleanBathroom">Clean toilet & sink (weekly)</label>
                        </li>
                        <li className="checkbox-item">
                            <input type="checkbox" id="trashManagement" checked={dailyQuests.trashManagement} onChange={() => handleDailyQuestChange('trashManagement')} />
                            <label htmlFor="trashManagement">Ensure trash is not overflowing & take it out (as needed)</label>
                        </li>
                        <li className="checkbox-item">
                            <input type="checkbox" id="recycling" checked={dailyQuests.recycling} onChange={() => handleDailyQuestChange('recycling')} />
                            <label htmlFor="recycling">Recycling (weekly)</label>
                        </li>
                        <li className="checkbox-item">
                            <input type="checkbox" id="cleanShower" checked={dailyQuests.cleanShower} onChange={() => handleDailyQuestChange('cleanShower')} />
                            <label htmlFor="cleanShower">Clean the shower (monthly/bi-weekly)</label>
                        </li>
                        <li className="checkbox-item">
                            <input type="checkbox" id="dogWalks" checked={dailyQuests.dogWalks} onChange={() => handleDailyQuestChange('dogWalks')} />
                            <label htmlFor="dogWalks">Walk the dog (at least twice a week - **schedule these!**)</label>
                        </li>
                        <li className="checkbox-item">
                            <input type="checkbox" id="midnightWalk" checked={dailyQuests.midnightWalk} onChange={() => handleDailyQuestChange('midnightWalk')} />
                            <label htmlFor="midnightWalk">Goal: Midnight walk together (every other day, 30 min long)</label>
                        </li>
                    </ul>
                </div>

                {/* Health & Coordination Tasks */}
                <div className="game-panel">
                    <h2 className="panel-title">Party Management & Logistics</h2>
                    <ul>
                        <li className="checkbox-item">
                            <input type="checkbox" id="medsAlarm" checked={dailyQuests.medsAlarm} onChange={() => handleDailyQuestChange('medsAlarm')} />
                            <label htmlFor="medsAlarm">**Medication Alarm (9 AM):** Take meds one hour before wake-up (or 9:30 AM initially)</label>
                        </li>
                        <li className="checkbox-item">
                            <input type="checkbox" id="monkeyBedroomClear" checked={dailyQuests.monkeyBedroomClear} onChange={() => handleDailyQuestChange('monkeyBedroomClear')} />
                            <label htmlFor="monkeyBedroomClear">**Monkey: Bedroom Clear by 12:20 PM** (for Bonobo's work/therapy at 12:30/1 PM)</label>
                        </li>
                        <li className="checkbox-item">
                            <input type="checkbox" id="monkeyOutfitPrep" checked={dailyQuests.monkeyOutfitPrep} onChange={() => handleDailyQuestChange('monkeyOutfitPrep')} />
                            <label htmlFor="monkeyOutfitPrep">**Monkey: Prepare outfits** for next day/evening outside the bedroom</label>
                        </li>
                        <li className="checkbox-item">
                            <input type="checkbox" id="monkeyADHDMeds" checked={dailyQuests.monkeyADHDMeds} onChange={() => handleDailyQuestChange('monkeyADHDMeds')} />
                            <label htmlFor="monkeyADHDMeds">**Monkey: ADHD Meds:** Find prescriber & make appointment within 10-20 days (Bonobo provides 20 pills)</label>
                        </li>
                        <li className="checkbox-item">
                            <input type="checkbox" id="monkeyDoctorAppt" checked={dailyQuests.monkeyDoctorAppt} onChange={() => handleDailyQuestChange('monkeyDoctorAppt')} />
                            <label htmlFor="monkeyDoctorAppt">**Monkey: Share Doctor Appointment Time** with Bonobo</label>
                        </li>
                        <li className="checkbox-item">
                            <input type="checkbox" id="fafsa" checked={dailyQuests.fafsa} onChange={() => handleDailyQuestChange('fafsa')} />
                            <label htmlFor="fafsa">Collaborate on completing FAFSA</label>
                        </li>
                        <li className="checkbox-item">
                            <input type="checkbox" id="mealPlanning" checked={dailyQuests.mealPlanning} onChange={() => handleDailyQuestChange('mealPlanning')} />
                            <label htmlFor="mealPlanning">Properly plan meals together</label>
                        </li>
                        <li className="checkbox-item">
                            <input type="checkbox" id="sharedCalendar" checked={dailyQuests.sharedCalendar} onChange={() => handleDailyQuestChange('sharedCalendar')} />
                            <label htmlFor="sharedCalendar">**By End of Month:** Buy tablet for shared calendar (fridge/sync)</label>
                        </li>
                    </ul>
                </div>

                {/* Communication Tools */}
                <div className="game-panel">
                    <h2 className="panel-title">Communication Tools: Quest Diplomacy</h2>
                    <div className="mb-4">
                        <h3 className="text-xl font-semibold mb-2" style={{ color: '#e8e6ff' }}>Safe Words:</h3>
                        <ul className="list-disc list-inside text-sm text-gray-300 pl-4">
                            <li>**For OCD Reassurance Seeking (Bonobo to Monkey):** When Bonobo needs to pause a conversation that's becoming overwhelming or repetitive, use a pre-agreed safe word like "**PAUSE**," "**RED LIGHT**," or "**RETURN LATER**." This signals a need for a break and promises a revisit.</li>
                            <li>**For Procrastination (Both):** When either person notices the other (or themselves) procrastinating on tasks, use a gentle cue like "**ADAM STEWART**" or "**BYRON**." This is a non-judgmental nudge to re-focus.</li>
                        </ul>
                    </div>
                    <div className="mb-4">
                        <h3 className="text-xl font-semibold mb-2" style={{ color: '#e8e6ff' }}>Question Limit Protocol:</h3>
                        <p className="text-sm text-gray-300 pl-4">
                            To manage reassurance-seeking conversations and preserve time, Monkey can ask questions for a maximum of **10 minutes per day**, or in **two separate instances per day** (e.g., two 5-minute sessions). This helps ensure both of you can get your tasks done and regulate. This also applies to the use of a "tally board" if desired.
                        </p>
                    </div>
                </div>

                {/* Groceries & Other Topics */}
                <div className="game-panel">
                    <h2 className="panel-title">Inventory & Party Chat</h2>
                    <p className="note-text mb-4">You can type directly into these fields to update them! (Changes will not be saved after closing the page, as there is no backend.)</p>
                    <div className="mb-4">
                        <h3 className="text-xl font-semibold mb-2" style={{ color: '#e8e6ff' }}>Items for Our Cart:</h3>
                        <div className="editable-list-area" contentEditable="true" data-placeholder="e.g., Milk, Eggs, Bread&#10;Add more items here..."></div>
                    </div>
                    <div className="mb-4">
                        <h3 className="text-xl font-semibold mb-2" style={{ color: '#e8e6ff' }}>Topics for Group Discussion (When We Have XP):</h3>
                        <div className="editable-list-area" contentEditable="true" data-placeholder="e.g., Weekend plans&#10;Monthly budget review&#10;Add more discussion topics here..."></div>
                    </div>
                    <div>
                        <h3 className="text-xl font-semibold mb-2" style={{ color: '#e8e6ff' }}>Items to Acquire (Store Run):</h3>
                        <div className="editable-list-area" contentEditable="true" data-placeholder="e.g., Tablet for shared calendar&#10;New dog toy&#10;Add more items to buy here..."></div>
                    </div>
                </div>
            </div>
        </div>
    );
};

export default App;
